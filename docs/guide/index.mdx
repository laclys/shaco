# 具体方案：

### 开发脚本

Shell脚本(需安装：brew install webp)(https://developers.google.com/speed/webp/docs/cwebp)


前端项目脚本
```javascript
const { join,resolve } = require('path')
const { execSync } = require('child_process');
const _root = resolve(__dirname, '..')

const arg = process.argv[2];
if (!!arg) {
  const targetPath = join(...[_root].concat(arg))
  const scriptPath = join(...[_root].concat('script/cwebp.sh'))

  execSync(`${scriptPath} ${targetPath}`, { stdio: [0, 1, 2] });
}
```
Usage:
```bash
<pnpm | npm | yarn> run cwebp <directory>
```

### 判断浏览器
```javascript
const isWebp = document.createElement("canvas").toDataURL("image/webp").includes("data:image/webp");
const htmDom = document.documentElement;
if(isWebp) {
  htmDom.classList.add("webpa");
}
```

### css/less...样式图片处理
以less为例其他样式预处理器同理
```css
/* webp mixin */
.webpbg(@url) {
      background-image: url(@url);
  .webpa & {
      background-image: url('@{url}.webp');
  }
}

// Usage

+ .webpbg(url)
- background-image(url)
```
项目mixin可通过webpack插件：`style-resources-loader` 统一引入

### JSX img标签处理
使用 兼容webp
Eg.
```javascript
import React from 'react';

const Img = (props) => (
  <picture className={props?.className}>
    <source
      className={props?.className}
      srcSet={`${props?.src}.webp`}
      type="image/webp"
    />
    <img className={props?.className} src={props?.src} alt={props?.alt} loading="lazy" />
  </picture>
  );

export default Img;

```